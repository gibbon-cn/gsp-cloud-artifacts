{"version":3,"sources":["./src/packages/state-machine/package.ts","./src/packages/state-machine/state-machine.module.js","./src/packages/state-machine/state_machine/state_machine.component.css","./src/packages/state-machine/state_machine/state_machine.component.html","./src/packages/state-machine/state_machine/state_machine.component.ts","./src/packages/state-machine/state_machine/state_machine_package_view.ts"],"names":[],"mappings":"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","file":"state-machine.module.chunk.js","sourcesContent":["import { StateMachinePackageView } from './state_machine/state_machine_package_view';\r\nimport { Package, GSP } from '@farris/ide-devkit';\r\nimport { ComponentFactoryResolver, Injector } from '@angular/core';\r\nexport class StateMachinePackage extends Package {\r\n    constructor(\r\n        gsp: GSP,\r\n        private cfr: ComponentFactoryResolver,\r\n        private injector: Injector\r\n    ) {\r\n        super(gsp);\r\n    }\r\n\r\n    activate(state) {\r\n        this.gsp.workspace.addOpener((uri) => {\r\n            return this.openStateMachine(uri);\r\n        });\r\n    }\r\n\r\n    openStateMachine(uri) {\r\n        if (uri.endsWith('.wsm')) {\r\n            const packageView = new StateMachinePackageView({}, this.cfr, this.injector);\r\n            // tslint:disable-next-line:no-unused-expression\r\n            packageView.getElement().instance.uri = uri;\r\n            return {\r\n                getTitle: () => '状态机元数据 - ' + uri.slice(uri.lastIndexOf('/') + 1),\r\n                getElement: () => packageView.getElement()\r\n            };\r\n        }\r\n\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/packages/state-machine/package.ts","var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport { StateMachineComponent } from './state_machine/state_machine.component';\r\nimport { StateMachinePackage } from './package';\r\nimport { AngularMonacoEditorModule, PackageModule } from '@farris/ide-devkit';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { NgModule, ComponentFactoryResolver, Injector } from '@angular/core';\r\nvar monacoConfig = {\r\n    baseUrl: './assets',\r\n    defaultOptions: { scrollBeyondLastLine: false },\r\n    onMonacoLoad: function () {\r\n    }\r\n};\r\nvar StateMachinModule = (function (_super) {\r\n    __extends(StateMachinModule, _super);\r\n    function StateMachinModule(cfr, injector) {\r\n        var _this = _super.call(this) || this;\r\n        _this.cfr = cfr;\r\n        _this.injector = injector;\r\n        return _this;\r\n    }\r\n    StateMachinModule.prototype.initPackage = function (gsp) {\r\n        this.package = new StateMachinePackage(gsp, this.cfr, this.injector);\r\n        // throw new Error('Method not implemented.');\r\n    };\r\n    StateMachinModule = __decorate([\r\n        NgModule({\r\n            imports: [\r\n                CommonModule,\r\n                FormsModule,\r\n                AngularMonacoEditorModule.forRoot(monacoConfig)\r\n            ],\r\n            declarations: [StateMachineComponent],\r\n            bootstrap: [StateMachineComponent]\r\n        }),\r\n        __metadata(\"design:paramtypes\", [ComponentFactoryResolver, Injector])\r\n    ], StateMachinModule);\r\n    return StateMachinModule;\r\n}(PackageModule));\r\nexport { StateMachinModule };\r\n//# sourceMappingURL=state-machine.module.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/packages/state-machine/state-machine.module.js\n// module id = ./src/packages/state-machine/state-machine.module.js\n// module chunks = state-machine.module","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/* .controlMatadataEditorContainer {\\r\\n  display: block;\\r\\n  position: absolute;\\r\\n  top: 65px;\\r\\n  bottom: 0px;\\r\\n  left: 0px;\\r\\n  right: 0px;\\r\\n}\\r\\n\\r\\n \\r\\n.controlMatadataEditorContainer .controlMatadataEditor {\\r\\n  height: calc(100vh - 0px);\\r\\n} */\\r\\n\\r\\n.controlMatadataEditorContainer .controlMatadataEditor {\\r\\n  position: absolute;\\r\\n  top: 65px;\\r\\n  bottom: 0px;\\r\\n  left: 0px;\\r\\n  right: 0px;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n\n\n/*** EXPORTS FROM exports-loader ***/\nmodule.exports = module.exports.toString();\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/packages/state-machine/state_machine/state_machine.component.css\n// module id = ./src/packages/state-machine/state_machine/state_machine.component.css\n// module chunks = state-machine.module","module.exports = \"<button class=\\\"k-button k-outline k-state-active\\\" (click)=\\\"saveForm()\\\">Save</button>\\r\\n<div class=\\\"controlMatadataEditorContainer\\\">\\r\\n    <angular-monaco-editor [options]=\\\"options\\\" class=\\\"controlMatadataEditor\\\" [(ngModel)]=\\\"content\\\" (onInit)=\\\"onInitHandler($event)\\\"></angular-monaco-editor>\\r\\n</div>\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/packages/state-machine/state_machine/state_machine.component.html\n// module id = ./src/packages/state-machine/state_machine/state_machine.component.html\n// module chunks = state-machine.module","import { Component, OnInit } from '@angular/core';\r\nimport { MetadataDto, GSPMetadataService } from '@gsp-lcm/metadata-selector';\r\nimport { CacheService } from '@farris/ide-devkit/services/cache';\r\n\r\n@Component({\r\n  selector: 'app-state_machine',\r\n  templateUrl: './state_machine.component.html',\r\n  styleUrls: ['./state_machine.component.css']\r\n})\r\nexport class StateMachineComponent implements OnInit {\r\n  public metadataDto: MetadataDto;\r\n  public content;\r\n  private sessionId: string;\r\n  options = {\r\n    theme: 'vs-dark',\r\n    language: 'json'\r\n  };\r\n\r\n\r\n  /**\r\n   * Getter uri\r\n   * @return {string}\r\n   */\r\n  public get uri(): string {\r\n    return this._uri;\r\n  }\r\n\r\n  /**\r\n   * Setter uri\r\n   * @param {string} value\r\n   */\r\n  public set uri(value: string) {\r\n    this._uri = value;\r\n    const arr = value.split('\\/');\r\n    let path = '\\/projects';\r\n    for (let i = 1; i < arr.length - 1; i++) {\r\n      path = path + '\\/' + arr[i];\r\n    }\r\n    this.getMetadata(arr[arr.length - 1], path);\r\n  }\r\n\r\n\r\n  /**\r\n *  文件相对路径\r\n */\r\n  private _uri: string;\r\n\r\n  constructor(private metadataService: GSPMetadataService, private cache: CacheService) {\r\n    this.sessionId = this.cache.get('sessionId');\r\n  }\r\n\r\n\r\n  /**\r\n   * 保存修改后的控件元数据\r\n   */\r\n  saveForm() {\r\n    this.metadataDto.content = this.content;\r\n    this.metadataService.SaveMetadata(this.metadataDto, this.sessionId).subscribe(data => {\r\n      alert('保存成功！');\r\n    },\r\n      error => {\r\n        alert('保存失败！');\r\n      }\r\n    );\r\n  }\r\n\r\n\r\n  /**\r\n   * 获取元数据信息\r\n   */\r\n  getMetadata(fullname?: string, path?: string) {\r\n    this.metadataService.LoadMetadata(fullname, path).subscribe(\r\n      data => {\r\n        this.metadataDto = data;\r\n        this.content = data.content;\r\n      }\r\n    );\r\n  }\r\n\r\n\r\n  /**\r\n   * 代码编辑器自动格式化\r\n   * @param event 打开编辑器事件\r\n   */\r\n  onInitHandler(event: any) {\r\n    setTimeout(() => {\r\n      event.editor.getAction('editor.action.formatDocument').run().then(null);\r\n    }, 200);\r\n  }\r\n\r\n\r\n  ngOnInit() {\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/packages/state-machine/state_machine/state_machine.component.ts","import { StateMachineComponent } from './state_machine.component';\r\nimport { PackageView } from '@farris/ide-devkit';\r\nimport { ComponentFactoryResolver, Injector } from '@angular/core';\r\nexport class StateMachinePackageView extends PackageView {\r\n    constructor(serializedState: any, private cfr: ComponentFactoryResolver, private injector: Injector) {\r\n        super(serializedState);\r\n        const factory = this.cfr.resolveComponentFactory(StateMachineComponent);\r\n        this.element = factory.create(this.injector);\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/packages/state-machine/state_machine/state_machine_package_view.ts"],"sourceRoot":"webpack:///"}